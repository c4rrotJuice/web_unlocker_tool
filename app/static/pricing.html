<!--pricing.html/js-->
<!doctype html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cite Unlocker Pricing</title>
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/static/js/auth.js"></script>
    <link rel="stylesheet" href="./css/pricing.css" />
  </head>

  <body>
    <header class="navbar">
      <div class="navbar-container">
        <!-- Logo -->
        <div class="logo">
          <img src="./images/logo_transparent.png" alt="Logo" />
        </div>

        <!-- Menu -->
        <nav>
          <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/pricing.html" class="active">Pricing</a></li>
            <li>
              <a href="https://citeunlock.choneize.com/terms"
                >Terms & Policies</a
              >
            </li>
            <li><a href="https://citeunlock.choneize.com/blog">Blog</a></li>
          </ul>
        </nav>

        <!-- Button -->
        <div class="nav-btn">
          <a href="/unlock" class="btn">Unlock a Page</a>
        </div>
      </div>
    </header>

    <!--                  Pricing                     -->
    <section id="pricing-1387">
      <div class="cs-container">
        <div class="cs-content">
          <span class="cs-topper">Our Pricing</span>
          <h2 class="cs-title">
            Flexible Pricing Plans for Your Tailored Needs
          </h2>
          <p class="cs-text">
            A tool for unlocking copy/paste functionality on websites that
            restrict such interaction
          </p>
          <div class="cs-toggle-group">
            <span id="cs-option1-1387" class="cs-plan">Pay Quarterly</span>
            <div class="cs-toggle" aria-label="click to switch plans pricing">
              <span aria-hidden="true" class="cs-toggle-switch"></span>
            </div>
            <span id="cs-option2-1387" class="cs-plan">Pay Monthly</span>
          </div>
        </div>

        <!-- Monthly -->
        <ul class="cs-card-group cs-option1">
          <li class="cs-item">
            <div class="cs-flex">
              <span class="cs-package">Freemium</span>
              <span class="cs-price"
                >$0.00 <span class="cs-duration">/Month</span></span
              >
              <div class="cs-tag">
                <img
                  class="cs-icon"
                  src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/fire.svg"
                  width="16"
                  height="16"
                  alt="fire"
                />
              </div>
            </div>
            <div class="cs-info">
              <ul class="cs-ul">
                <li class="cs-li">Unlocked Copy/Paste</li>
                <li class="cs-li">Copied Text Citation Generator</li>
                <li class="cs-li">5 Daily Usages</li>
              </ul>
              <a href="/auth" class="cs-button-transparent"
                >Sign Up</a
              >
            </div>
          </li>

          <li class="cs-item cs-popular">
            <div class="cs-flex">
              <span class="cs-package">Standard Tier</span>
              <span class="cs-price"
                >$5 <span class="cs-duration">/Month</span></span
              >
              <div class="cs-tag">
                <img
                  class="cs-icon"
                  src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/fire.svg"
                  width="16"
                  height="16"
                  alt="fire"
                />
                POPULAR
              </div>
            </div>
            <div class="cs-info">
              <ul class="cs-ul">
                <li class="cs-li">Unlocked Copy/Paste</li>
                <li class="cs-li">Copied Text Citation Generator</li>
                <li class="cs-li">Unlimited Usages</li>
                <li class="cs-li">Analytics & History/Bookmarks</li>
                <li class="cs-li">No Ads</li>
              </ul>
              <a
                href="javascript:void(0)"
                onclick="openCheckout('standard', 'Monthly')"
                class="cs-button-transparent"
                >Get Now</a
              >
            </div>
          </li>

          <li class="cs-item cs-popular">
            <div class="cs-flex">
              <span class="cs-package">Pro Tier</span>
              <span class="cs-price"
                >$9 <span class="cs-duration">/Month</span></span
              >
              <div class="cs-tag">
                <img
                  class="cs-icon"
                  src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/fire.svg"
                  width="16"
                  height="16"
                  alt="fire"
                />
                Hot Deal
              </div>
            </div>
            <div class="cs-info">
              <ul class="cs-ul">
                <li class="cs-li">All Standard-Tier Options</li>
                <li class="cs-li">Dedicated Text Editor (PDF/docx export)</li>
                <li class="cs-li">Gramma & Spell-Check</li>
                <li class="cs-li">Basic AI Check</li>
                <li class="cs-li">Priority Unlock Que ue</li>
              </ul>
              <a
                href="javascript:void(0)"
                onclick="openCheckout('pro', 'Monthly')"
                class="cs-button-transparent"
                >Get Now</a
              >
            </div>
          </li>
        </ul>

        <!-- Annual -->
        <ul class="cs-card-group cs-option2">
          <li class="cs-item cs-popular">
            <div class="cs-flex">
              <span class="cs-package">Standard Quarterly</span>
              <span class="cs-price"
                >$12 <span class="cs-duration">/3months</span></span
              >
              <div class="cs-tag">
                <img
                  class="cs-icon"
                  src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/fire.svg"
                  width="16"
                  height="16"
                  alt="fire"
                />
              </div>
            </div>
            <div class="cs-info">
              <ul class="cs-ul">
                <li class="cs-li">Unlocked Copy/Paste</li>
                <li class="cs-li">Copied Text Citation Generator</li>
                <li class="cs-li">Unlimited Usages</li>
                <li class="cs-li">Analytics & History/Bookmarks</li>
                <li class="cs-li">No Ads</li>
                <li class="cs-li">Billed per 3 Months</li>
              </ul>
              <a
                href="javascript:void(0)"
                onclick="openCheckout('standard', 'Quarterly')"
                class="cs-button-transparent"
                >Get Now</a
              >
            </div>
          </li>
          <li class="cs-item">
            <div class="cs-flex">
              <span class="cs-package">Pro Quartely</span>
              <span class="cs-price"
                >$20 <span class="cs-duration">/3months</span></span
              >
              <div class="cs-tag">
                <img
                  class="cs-icon"
                  src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/fire.svg"
                  width="16"
                  height="16"
                  alt="fire"
                />
                Hot Deal
              </div>
            </div>
            <div class="cs-info">
              <ul class="cs-ul">
                <li class="cs-li">All Standard-Tier Options</li>
                <li class="cs-li">Dedicated Text Editor (PDF/docx export)</li>
                <li class="cs-li">Gramma & Spell-Check</li>
                <li class="cs-li">Basic AI Check</li>
                <li class="cs-li">Priority Unlock Que ue</li>
                <li class="cs-li">Billed per 3 Months</li>
              </ul>
              <a
                href="javascript:void(0)"
                onclick="openCheckout('pro', 'Quarterly')"
                class="cs-button-transparent"
                >Get Now</a
              >
            </div>
          </li>
        </ul>
      </div>
    </section>

    <script>
      // Toggle logic
      const leftOption = document.querySelector(
        "#pricing-1387 #cs-option1-1387",
      );
      const rightOption = document.querySelector(
        "#pricing-1387 #cs-option2-1387",
      );
      const toggle = document.querySelector("#pricing-1387 .cs-toggle");
      const cardGroup = Array.from(
        document.querySelectorAll("#pricing-1387 .cs-card-group"),
      );

      toggle.addEventListener("click", () => {
        cardGroup.forEach((item) => item.classList.toggle("cs-active"));
        toggle.classList.toggle("active");
      });
      leftOption.addEventListener("click", () => {
        cardGroup.forEach((item) => item.classList.remove("cs-active"));
        toggle.classList.remove("active");
      });
      rightOption.addEventListener("click", () => {
        cardGroup.forEach((item) => item.classList.add("cs-active"));
        toggle.classList.add("active");
      });
      //===========================================================================================================================

      const CONFIG = {
        environment: "sandbox",
      };

      let currentUserId = null;
      let currentUserEmail = null;
      let paddleReady = false;
      let paddleInitError = null;

      async function authHeaders() {
        const token = await window.webUnlockerAuth?.getAccessToken?.();
        return token ? { Authorization: `Bearer ${token}` } : {};
      }

      async function loadCurrentUser() {
        try {
          const res = await fetch("/api/me", {
            headers: await authHeaders(),
            credentials: "include",
          });

          if (!res.ok) {
            currentUserId = null;
            return;
          }
          const data = await res.json();
          currentUserId = data.user_id || null;
          currentUserEmail = data.email || null;
        } catch (err) {
          console.error("‚ùå Failed to load user info:", err);
          currentUserId = null;
          currentUserEmail = null;
        }
      }

      async function initPaddle() {
        try {
          const res = await fetch("/get_paddle_token", {
            headers: await authHeaders(),
            credentials: "include",
          });
          if (!res.ok) {
            const errorText = await res.text();
            throw new Error(errorText || "Failed to fetch Paddle token");
          }
          const data = await res.json();

          if (!data.token) {
            throw new Error("No Paddle token returned");
          }

          const paddleEnv = data.environment || CONFIG.environment;
          Paddle.Environment.set(paddleEnv);
          Paddle.Initialize({
            token: data.token,
            eventCallback: (event) => {
              console.log("üîî Paddle event:", event);
            },
          });

          console.log("‚úÖ Paddle initialized with backend token");
          paddleReady = true;
        } catch (err) {
          paddleReady = false;
          paddleInitError = err;
          console.error("‚ùå Paddle init failed:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", async () => {
        await loadCurrentUser();
        await initPaddle();
      });
      // Open checkout for a plan
      function openCheckout(plan, cycle) {
        if (!currentUserId) {
          alert("Please log in before subscribing.");
          window.location.href = "/auth";
          return;
        }
        if (!paddleReady) {
          alert(
            "Billing isn't ready yet. Please refresh the page or try again later.",
          );
          if (paddleInitError) {
            console.error("Paddle init error:", paddleInitError);
          }
          return;
        }

        (async () => {
          const auth = await authHeaders();
          fetch("/create_paddle_checkout", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            ...auth,
          },
          credentials: "include",
          body: JSON.stringify({ plan, cycle }),
        })
          .then(async (res) => {
            if (!res.ok) {
              const errorText = await res.text();
              throw new Error(
                errorText || "Failed to create a Paddle checkout session",
              );
            }
            return res.json();
          })
          .then((data) => {
            if (!data.transaction_id) {
              throw new Error("Missing Paddle transaction ID");
            }
            Paddle.Checkout.open({
              transactionId: data.transaction_id,
              customer: currentUserEmail
                ? { email: currentUserEmail }
                : undefined,
              settings: {
                theme: "light",
                displayMode: "overlay",
                successUrl: "https://citeunlock.choneize.com/success",
              },
            });
          })
          .catch((err) => {
            console.error("‚ùå Failed to open Paddle checkout:", err);
            alert(
              "We couldn't start the checkout. Please refresh and try again.",
            );
          });
        })();
      }
    </script>
  </body>
</html>

document.addEventListener("DOMContentLoaded",function(){console.log("Unlock script initialized.");const e=["contextmenu","copy","cut","selectstart","mousedown","keydown"];e.forEach(e=>{window.addEventListener(e,e=>e.stopPropagation(),{capture:!0}),document.addEventListener(e,e=>e.stopPropagation(),{capture:!0})}),document.oncontextmenu=document.oncopy=document.onselectstart=null,document.body.oncontextmenu=document.body.oncopy=document.body.onselectstart=null;const t=document.createElement("style");t.textContent=`\n    * { \n      -webkit-user-select: text !important;\n      -moz-user-select: text !important;\n      -ms-user-select: text !important;\n      user-select: text !important;\n    }\n    \n    .copy-cite-btn {\n      position: absolute;\n      background: #282c34;\n      color: #fff;\n      padding: 6px 12px;\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n      font-size: 13px;\n      font-weight: 500;\n      border-radius: 6px;\n      z-index: 10001;\n      cursor: pointer;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n      transition: transform 0.1s ease-out;\n    }\n    .copy-cite-btn:hover {\n      transform: scale(1.05);\n    }\n\n    .citation-popup {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: #fff;\n      padding: 24px;\n      border-radius: 12px;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n      z-index: 10002;\n      width: 90%;\n      max-width: 550px;\n      border: 1px solid #e2e8f0;\n    }\n\n    .blurred-backdrop {\n      position: fixed;\n      top: 0; left: 0;\n      width: 100vw;\n      height: 100vh;\n      backdrop-filter: blur(5px);\n      background: rgba(0,0,0,0.4);\n      z-index: 10000;\n    }\n\n    .citation-popup h3 {\n      margin-top: 0;\n      font-size: 18px;\n      font-family: inherit;\n      color: #333;\n    }\n    .citation-popup pre {\n      background: #f1f5f9;\n      padding: 12px;\n      border-radius: 6px;\n      overflow-x: auto;\n      font-family: "Courier New", Courier, monospace;\n      font-size: 14px;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n    }\n    .citation-popup .copy-btn {\n      background-color: #3b82f6;\n      color: #fff;\n      padding: 8px 12px;\n      margin-top: 8px;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-size: 14px;\n      transition: background-color 0.2s;\n    }\n    .citation-popup .copy-btn:hover {\n      background-color: #2563eb;\n    }\n\n    .copied-toast {\n      position: fixed;\n      bottom: 30px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: #282c34;\n      color: #fff;\n      padding: 12px 20px;\n      border-radius: 8px;\n      font-size: 14px;\n      z-index: 10003;\n      opacity: 0;\n      transition: opacity 0.3s ease, transform 0.3s ease;\n      transform: translate(-50%, 10px);\n    }\n    .copied-toast.show {\n      opacity: 1;\n      transform: translate(-50%, 0);\n    }\n  `,document.head.appendChild(t);let o="";function n(){const e=document.querySelector(".copy-cite-btn");e&&e.remove()}function c(e){e.key==="Escape"&&s()}function s(){document.querySelector(".citation-popup")?.remove(),document.querySelector(".blurred-backdrop")?.remove(),document.removeEventListener("keydown",c)}function a(e,t=!1){const o=document.createElement("div");o.className="copied-toast",t&&(o.style.backgroundColor="#ef4444"),o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>o.remove(),300)},2500)}function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}document.addEventListener("mouseup",e=>{if(e.target.closest(".citation-popup"))return;const t=window.getSelection().toString().trim();t.length>5?(o=t,function(e,t){n();const o=document.createElement("div");o.className="copy-cite-btn",o.textContent="Copy + Cite âœ¨",o.style.left=`${e}px`,o.style.top=`${t+15}px`,o.onclick=()=>{n(),function(e){const t=window.location.href,o=document.title||"Untitled Page",n=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),a=`"${e}" *${o}*. Accessed ${n}, ${t}.`,l=`(${n}). *${o}*. Retrieved from ${t}\n\n"${e}"`;const d=document.createElement("div");d.className="blurred-backdrop";const r=document.createElement("div");r.className="citation-popup",r.innerHTML=`\n      <h3>Cite This Content</h3>\n      <strong>MLA Format:</strong>\n      <pre id="mla-cite">${i(a)}</pre>\n      <button class="copy-btn" data-target="mla-cite">Copy MLA</button>\n      <br/><br/>\n      <strong>APA Format:</strong>\n      <pre id="apa-cite">${i(l)}</pre>\n      <button class="copy-btn" data-target="apa-cite">Copy APA</button>\n    `,d.onclick=()=>s(),r.addEventListener("click",e=>{e.target.classList.contains("copy-btn")&&async function(e){const t=document.getElementById(e).innerText;try{await navigator.clipboard.writeText(t),a("Citation copied!")}catch(o){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy"),a("Citation copied!")}catch(e){a("Copy failed. Please try manually.",!0)}document.body.removeChild(e)}setTimeout(s,500)}(e.target.dataset.target)}),document.body.appendChild(d),document.body.appendChild(r),document.addEventListener("keydown",c)}(o)},document.body.appendChild(o)}(e.pageX,e.pageY)):n()}),document.addEventListener("mousedown",e=>{e.target.classList.contains("copy-cite-btn")||n()})});

